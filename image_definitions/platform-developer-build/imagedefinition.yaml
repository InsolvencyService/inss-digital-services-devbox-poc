$schema: "1.0"
name: "platform-developer-image-definition-yaml"
image: microsoftvisualstudio_visualstudioplustools_vs-2022-pro-general-win11-m365-gen2

tasks:
  - name: winget
    description: "Install Microsoft SQLServer Management Studio 21"
    parameters:
      package: Microsoft.SQLServerManagementStudio.21

  - name: ~/winget
    parameters:
      package: OpenJS.NodeJS

  - name: ~/winget
    description: "Install Chrome"
    parameters:
      package: Google.Chrome

  - name: ~/winget
    description: "Install Notepad++"
    parameters:
      package: Notepad++.Notepad++

  - name: git-clone
    description: "Clone INSS Digital Platform to c:\\repos"
    parameters:
      repositoryUrl: https://github.com/InsolvencyService/inss-digital-services-platform.git
      directory: c:\repos
      
userTasks:
  - name: install-sqlserver
    description: "Install SQL Server 2022 Developer silently"
    parameters:
      command: |
        $package = winget download Microsoft.SQLServer.2022.Developer --accept-package-agreements --accept-source-agreements --id Microsoft.SQLServer.2022.Developer --download-directory "C:\Temp\SQL2022"
        $setup = Get-ChildItem "C:\Temp\SQL2022" -Recurse -Filter setup.exe | Select-Object -First 1

        & $setup.FullName /Q /ACTION=Install /FEATURES=SQLENGINE `
          /INSTANCENAME=MSSQLSERVER `
          /SQLSVCACCOUNT="NT AUTHORITY\SYSTEM" `
          /SQLSYSADMINACCOUNTS="Administrators" `
          /IACCEPTSQLSERVERLICENSETERMS=True

  - name: ~/winget
    description: "Install Postman"
    parameters:
      package: Postman.Postman
      


